{% extends 'landing/base.html' %}
{% load static %}

{% block content %}
<div class="container my-5 mt-6">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card bg-dark text-white shadow-lg p-4">
                <h2 class="text-center mb-4 mt-2 custom-text-color">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                <form method="POST" action="{% url 'signup' %}">
                    {% csrf_token %}
                    {{ form.non_field_errors }}

                    <div class="mb-3">
                        <label for="id_first_name" class="form-label">–ò–º—è</label>
                        <input type="text" name="first_name" id="id_first_name" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" required>
                        {{ form.first_name.errors }}
                    </div>

                    <div class="mb-3">
                        <label for="id_last_name" class="form-label">–§–∞–º–∏–ª–∏—è</label>
                        <input type="text" name="last_name" id="id_last_name" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é" required>
                        {{ form.last_name.errors }}
                    </div>

                    <div class="mb-3">
                        <label for="id_email" class="form-label">Email</label>
                        <input type="email" name="email" id="id_email" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ email" required>
                        {{ form.email.errors }}
                    </div>

                    <div class="mb-3">
                        <label for="id_password1" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" name="password1" id="password1" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                        {{ form.password1.errors }}
                    </div>

                    <div class="mb-3">
                        <label for="id_password2" class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</label>
                        <input type="password" name="password2" id="password2" class="form-control" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                        {{ form.password2.errors }}
                    </div>

                    <div class="mb-3">
                        <label for="id_role" class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</label>
                        <select name="role" id="id_role" class="form-control" required>
                            <option value="gourmand">–ì—É—Ä–º–∞–Ω</option>
                            <option value="owner">–í–ª–∞–¥–µ–ª–µ—Ü –∑–∞–≤–µ–¥–µ–Ω–∏—è</option>
                        </select>
                        {{ form.role.errors }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ü—Ä–æ–≤–µ—Ä–∫–∞</label>
                        <div id="captcha-container" class="smart-captcha" data-sitekey="{{ settings.YANDEX_CAPTCHA_CLIENT_KEY }}"
                                                                        data-callback="smartCaptchaCallback"></div>
                    
                        <input type="hidden" name="captcha" id="id_captcha">
                        {{ form.captcha.errors }}
                    </div>
                    <div class="button_user pt-4 d-flex justify-content-center">
                        <button type="submit" class="custom-button custom-text-color bg_dark">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                    </div>
                </form>

                <div class="text-center mt-3">
                    <p>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="{% url 'signin' %}" class="text-warning">–í–æ–π—Ç–∏</a></p>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    window.smartCaptchaCallback = function(token) {
        console.log("üìå –ö–∞–ø—á–∞ —Å—Ä–∞–±–æ—Ç–∞–ª–∞, —Ç–æ–∫–µ–Ω:", token);
        document.getElementById('id_captcha').value = token;
    };

    document.querySelector('form').addEventListener('submit', function(event) {
        const captchaToken = document.getElementById('id_captcha').value;
        if (!captchaToken) {
            event.preventDefault();
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–π–¥–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–ø—á–∏.');
        }
        // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
        const submitButton = this.querySelector('button[type="submit"]');
        submitButton.disabled = true;
        submitButton.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
    });
</script>
<script src="https://smartcaptcha.yandexcloud.net/captcha.js" defer></script>
{% endblock %}